version: '3.8'

services:
  discord-bot:
    build: .
    restart: always
    environment:
      - MONGO_URI=${MONGO_URI}
      - OLLAMA_BASE_URL=http://ollama:11434
      - DISCORD_TOKEN=${DISCORD_TOKEN}
    depends_on:
      - ollama

  ollama:
    image: ollama/ollama:latest
    restart: always
    volumes:
      - ollama_models:/root/.ollama
    environment:
      - OLLAMA_KEEP_ALIVE=-1
      - OLLAMA_NUM_PARALLEL=4
    entrypoint: /bin/sh
    command: -c "ollama serve & sleep 5 && ollama pull qwen2.5-coder:0.5b && wait"

volumes:
  ollama_models:
